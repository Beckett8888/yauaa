#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2018 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

config:

- matcher:
    require:
    - 'agent.product.comments.entry.url="http://www.google.com/bot.html"'
    extract:
    - '__Set_ALL_Fields__                  :   2999 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3000 :"Robot"'
    - 'DeviceBrand                         :   3000 :"Google"'
    - 'DeviceName                          :   3000 :"Google"'
    - 'OperatingSystemClass                :   3000 :"Cloud"'
    - 'OperatingSystemName                 :   3000 :"Google"'
    - 'OperatingSystemVersion              :   3000 :"Google"'
    - 'LayoutEngineClass                   :   3000 :"Robot"'
    - 'LayoutEngineName                    :   3000 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3000 :"Googlebot"'
    - 'AgentClass                          :   3000 :"Robot"'
    - 'AgentName                           :   3000 :agent.product.comments.entry.product.name{"Googlebot"@'
    - 'AgentVersion                        :   3000 :agent.product.comments.entry.product.name{"Googlebot"^.version'

- matcher:
    extract:
    - '__Set_ALL_Fields__                  :   3009 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3010 :"Robot"'
    - 'DeviceBrand                         :   3010 :"Google"'
    - 'DeviceName                          :   3010 :"Google"'
    - 'OperatingSystemClass                :   3010 :"Cloud"'
    - 'OperatingSystemName                 :   3010 :"Google"'
    - 'OperatingSystemVersion              :   3010 :"Google"'
    - 'LayoutEngineClass                   :   3010 :"Robot"'
    - 'LayoutEngineName                    :   3010 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3010 :"Googlebot"'
    - 'AgentClass                          :   3010 :"Robot"'
    - 'AgentName                           :   3010 :agent.(1)product.name{"Googlebot"@'
    - 'AgentVersion                        :   3010 :agent.(1)product.name{"Googlebot"^.version'

# ------------------------------------------------------------

- matcher:
    require:
    - 'agent.(1)product.(1)name="AdsBot-Google"'
    extract:
    - '__Set_ALL_Fields__                  :   3019 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3020 :"Robot"'
    - 'DeviceBrand                         :   3020 :"Google"'
    - 'DeviceName                          :   3020 :"Google"'
    - 'OperatingSystemClass                :   3020 :"Cloud"'
    - 'OperatingSystemName                 :   3020 :"Google"'
    - 'OperatingSystemVersion              :   3020 :"Google"'
    - 'LayoutEngineClass                   :   3020 :"Robot"'
    - 'LayoutEngineName                    :   3020 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3020 :"Googlebot"'
    - 'AgentClass                          :   3020 :"Robot"'
    - 'AgentName                           :   3020 :"Googlebot"'
    - 'AgentVersion                        :   3020 :"AdsBot-Google"'

- matcher:
    require:
    - 'agent.product.comments.entry.(1)text="AdsBot-Google"'
    extract:
    - '__Set_ALL_Fields__                  :   3019 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3020 :"Robot"'
    - 'DeviceBrand                         :   3020 :"Google"'
    - 'DeviceName                          :   3020 :"Google"'
    - 'OperatingSystemClass                :   3020 :"Cloud"'
    - 'OperatingSystemName                 :   3020 :"Google"'
    - 'OperatingSystemVersion              :   3020 :"Google"'
    - 'LayoutEngineClass                   :   3020 :"Robot"'
    - 'LayoutEngineName                    :   3020 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3020 :"Googlebot"'
    - 'AgentClass                          :   3020 :"Robot"'
    - 'AgentName                           :   3020 :"Googlebot"'
    - 'AgentVersion                        :   3020 :"AdsBot-Google"'


- matcher:
    require:
    - 'agent.(1)product.(1)name="AdsBot-Google-Mobile"'
    extract:
    - '__Set_ALL_Fields__                  :   3019 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3020 :"Robot Mobile"'
    - 'DeviceBrand                         :   3020 :"Google"'
    - 'DeviceName                          :   3020 :"Google"'
    - 'OperatingSystemClass                :   3020 :"Cloud"'
    - 'OperatingSystemName                 :   3020 :"Google"'
    - 'OperatingSystemVersion              :   3020 :"Google"'
    - 'LayoutEngineClass                   :   3020 :"Robot"'
    - 'LayoutEngineName                    :   3020 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3020 :"Googlebot"'
    - 'AgentClass                          :   3020 :"Robot"'
    - 'AgentName                           :   3020 :"Googlebot"'
    - 'AgentVersion                        :   3020 :"AdsBot-Google-Mobile"'

- matcher:
    require:
    - 'agent.product.comments.entry.(1)text="AdsBot-Google-Mobile"'
    extract:
    - '__Set_ALL_Fields__                  :   3019 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :   3020 :"Robot Mobile"'
    - 'DeviceBrand                         :   3020 :"Google"'
    - 'DeviceName                          :   3020 :"Google"'
    - 'OperatingSystemClass                :   3020 :"Cloud"'
    - 'OperatingSystemName                 :   3020 :"Google"'
    - 'OperatingSystemVersion              :   3020 :"Google"'
    - 'LayoutEngineClass                   :   3020 :"Robot"'
    - 'LayoutEngineName                    :   3020 :"Googlebot"'
    - 'LayoutEngineVersion                 :   3020 :"Googlebot"'
    - 'AgentClass                          :   3020 :"Robot"'
    - 'AgentName                           :   3020 :"Googlebot"'
    - 'AgentVersion                        :   3020 :"AdsBot-Google-Mobile"'

# ------------------------------------------------------------
#Googlebot-Mobile

# Mobile google bots

- matcher:
    require:
    - 'agent.product.comments.entry.(1)product.(1)name="Googlebot"'
    - 'agent.product.name="Mobile"'
    extract:
    - 'AgentClass                          :  10000 :"Robot Mobile"'
    - 'DeviceClass                         :  10000 :"Robot Mobile"'

- matcher:
    require:
    - 'agent.product.comments.entry.(1)product.(1)name="Googlebot"'
    - 'agent.product.name="Mobile Safari"'
    extract:
    - 'AgentClass                          :  10000 :"Robot Mobile"'
    - 'DeviceClass                         :  10000 :"Robot Mobile"'

- matcher:
    require:
    - 'agent.product.comments.entry.(1)product.(1)name="Googlebot-Mobile"'
    extract:
    - 'AgentClass                          :  10000 :"Robot Mobile"'
    - 'DeviceClass                         :  10000 :"Robot Mobile"'

# ------------------------------------------------------------

# Google developer testing tool
- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry~"testing"'
    extract:
    - 'AgentClass                          :   1000 :"Testclient"'

- matcher:
    extract:
    - 'DeviceClass                         :    115 :"Robot"'
    - 'DeviceName                          :    115 :"Google Search Appliance"'
    - 'DeviceBrand                         :    115 :"Google"'
    - 'AgentClass                          :    115 :"Robot"'
    - 'AgentName                           :    115 :"Google Search Appliance"'
    - 'GSAInstallationID                   :    115 :agent.(1)product.(1)comments.(2)entry.(1)text[-1]="GID"@'

- matcher:
    require:
    - 'agent.(1)product.(1)name="AppEngine-Google"'
    - 'agent.(1)product.(1)comments.(1)entry.(1)url="http://code.google.com/appengine"'
    - 'agent.(1)product.(1)comments.(2)entry.(1)keyvalue.(1)key="appid"'
    extract:
    - 'DeviceClass                         :    100 :"Robot"'
    - 'DeviceName                          :    100 :"Google AppEngine"'
    - 'DeviceBrand                         :    100 :"Google"'
    - 'AgentClass                          :    100 :"Cloud Application"'
    - 'AgentName                           :    100 :agent.(1)product.(1)comments.(2)entry.(1)keyvalue.(1)version[1]="s"@[2]'
    - 'AgentVersion                        :    100 :"??"'

- matcher:
    require:
    - 'agent.(1)product.(1)name="AppEngine-Google"'
    - 'agent.(1)product.(1)comments.(1)entry.(1)url="http://code.google.com/appengine"'
    - 'agent.(1)product.(1)comments.(2)entry.(1)keyvalue.(1)key="appid"'
    extract:
    - 'DeviceClass                         :    100 :"Robot"'
    - 'DeviceName                          :    100 :"Google AppEngine"'
    - 'DeviceBrand                         :    100 :"Google"'
    - 'AgentClass                          :    100 :"Cloud Application"'
    - 'AgentName                           :    100 :agent.(1)product.(1)comments.(2)entry.(1)keyvalue.(2)text[1]="s"@[2]'
    - 'AgentVersion                        :    100 :"??"'

- matcher:
    require:
    - 'agent.(1)product.(1)name~"bot"'
    - 'agent.(1)product.(1)name~"Google"'
    extract:
    - 'DeviceBrand                         :    200 :"Google"'

#Google AppEngine apps
#AppEngine-Google; (+http://code.google.com/appengine; appid: s~loa10167767606076078)
#AppEngine-Google; (+http://code.google.com/appengine; appid: s~magicscrollreader234)
#AppEngine-Google; (+http://code.google.com/appengine; appid: s~misterhac)

# Google shopping quality checks

- matcher:
    require:
    - 'agent.product.(1)comments.entry.(1)product.name="Google-Shopping-Quality"'
    - 'agent.product.name="Mobile"'
    extract:
    - 'DeviceClass                         :  10000 :"Robot Mobile"'
    - 'DeviceName                          :  10000 :"Google"'
    - 'DeviceBrand                         :  10000 :"Google"'
    - 'DeviceVersion                       :  10000 :"Google-Shopping-Quality"'
    - 'DeviceFirmwareVersion               :  10000 :"Google"'
    - 'OperatingSystemClass                :  10000 :"Cloud"'
    - 'OperatingSystemName                 :  10000 :"Google"'
    - 'OperatingSystemVersion              :  10000 :"Google"'
    - 'OperatingSystemNameVersion          :  10000 :"Google"'
    - 'LayoutEngineClass                   :  10000 :"Robot"'
    - 'LayoutEngineName                    :  10000 :"Googlebot"'
    - 'LayoutEngineVersion                 :  10000 :"Googlebot"'
    - 'AgentClass                          :  10000 :"Robot Mobile"'
    - 'AgentName                           :  10000 :"Google-Shopping-Quality"'
    - 'AgentVersion                        :  10000 :"??"'

- matcher:
    require:
    - 'agent.product.(1)comments.entry.(1)product.name="Google-Shopping-Quality"'
    - 'IsNull[agent.product.name="Mobile"]'
    extract:
    - 'DeviceClass                         :  10000 :"Robot"'
    - 'DeviceName                          :  10000 :"Google"'
    - 'DeviceBrand                         :  10000 :"Google"'
    - 'DeviceVersion                       :  10000 :"Google-Shopping-Quality"'
    - 'DeviceFirmwareVersion               :  10000 :"Google"'
    - 'OperatingSystemClass                :  10000 :"Cloud"'
    - 'OperatingSystemName                 :  10000 :"Google"'
    - 'OperatingSystemVersion              :  10000 :"Google"'
    - 'OperatingSystemNameVersion          :  10000 :"Google"'
    - 'LayoutEngineClass                   :  10000 :"Robot"'
    - 'LayoutEngineName                    :  10000 :"Googlebot"'
    - 'LayoutEngineVersion                 :  10000 :"Googlebot"'
    - 'AgentClass                          :  10000 :"Robot"'
    - 'AgentName                           :  10000 :"Google-Shopping-Quality"'
    - 'AgentVersion                        :  10000 :"??"'

#TODO: gfe means the Google Front End
#Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0,gzip(gfe) (via shopping.google.com)
# https://support.google.com/webmasters/answer/1061943?hl=en
# http://stackoverflow.com/questions/2862874/what-is-gzipgfe


# https://developers.google.com/speed/docs/insights/faq#whyonlinediff
- matcher:
    require:
    - 'agent.product.(1)comments.entry="Google Page Speed Insights"'
    extract:
    - '__Set_ALL_Fields__                  :   9999 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :  10000 :"Robot"'
    - 'DeviceName                          :  10000 :"Google"'
    - 'DeviceBrand                         :  10000 :"Google"'
    - 'DeviceVersion                       :  10000 :"Google Page Speed Insights"'
    - 'DeviceFirmwareVersion               :  10000 :"Google"'
    - 'OperatingSystemClass                :  10000 :"Cloud"'
    - 'OperatingSystemName                 :  10000 :"Google"'
    - 'OperatingSystemVersion              :  10000 :"Google"'
    - 'OperatingSystemNameVersion          :  10000 :"Google"'
    - 'LayoutEngineClass                   :  10000 :"Robot"'
    - 'LayoutEngineName                    :  10000 :"Google Page Speed Insights"'
    - 'LayoutEngineVersion                 :  10000 :"??"'
    - 'AgentClass                          :  10000 :"Robot"'
    - 'AgentName                           :  10000 :"Google Page Speed Insights"'
    - 'AgentVersion                        :  10000 :"??"'

# https://support.google.com/webmasters/answer/1062498?hl=en

- matcher:
    require:
    - 'agent.product.(1)comments.entry[1-2]="Google Web"'
    extract:
    - '__Set_ALL_Fields__                  :   9999 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :  10000 :"Robot"'
    - 'DeviceName                          :  10000 :"Google"'
    - 'DeviceBrand                         :  10000 :"Google"'
    - 'DeviceVersion                       :  10000 :agent.product.(1)comments.entry[1-3]="Google Web Preview"@'
    - 'DeviceFirmwareVersion               :  10000 :"Google"'
    - 'OperatingSystemClass                :  10000 :"Cloud"'
    - 'OperatingSystemName                 :  10000 :"Google"'
    - 'OperatingSystemVersion              :  10000 :"Google"'
    - 'OperatingSystemNameVersion          :  10000 :"Google"'
    - 'LayoutEngineClass                   :  10000 :"Robot"'
    - 'LayoutEngineName                    :  10000 :agent.product.(1)comments.entry[1-3]="Google Web Preview"@'
    - 'LayoutEngineVersion                 :  10000 :"??"'
    - 'AgentClass                          :  10000 :"Robot"'
    - 'AgentName                           :  10000 :agent.product.(1)comments.entry[1-3]="Google Web Preview"@'
    - 'AgentVersion                        :  10000 :"??"'


# Google developer testing tool
- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry="Google-Test"'
    extract:
    - 'DeviceClass                         :   1000 :"Robot"'
    - 'DeviceName                          :   1000 :"Robot"'
    - 'DeviceBrand                         :   1000 :"Google"'
    - 'OperatingSystemClass                :   1000 :"Cloud"'
    - 'OperatingSystemName                 :   1000 :"Cloud"'
    - 'OperatingSystemVersion              :   1000 :"Cloud"'
    - 'LayoutEngineClass                   :   1000 :"Robot"'
    - 'LayoutEngineName                    :   1000 :"Google-Test"'
    - 'LayoutEngineVersion                 :   1000 :"??"'
    - 'AgentClass                          :   1000 :"Testclient"'
    - 'AgentName                           :   1000 :"Google-Test"'
    - 'AgentVersion                        :   1000 :"??"'



