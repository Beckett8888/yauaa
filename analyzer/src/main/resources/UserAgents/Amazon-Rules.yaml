#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2018 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
config:
# https://developer.amazon.com/public/solutions/devices/kindle-fire/specifications/01-device-and-feature-specifications
# https://developer.amazon.com/public/solutions/devices/fire-tablets/specifications/04-user-agent-strings
# http://docs.aws.amazon.com/silk/latest/developerguide/user-agent.html
# http://docs.aws.amazon.com/silk/latest/developerguide/screen-size.html
# https://developer.amazon.com/public/solutions/devices/fire-phone/docs/fire-phone-user-agent-strings
# https://developer.amazon.com/docs/fire-tablets/ft-user-agent-strings.html


- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name{"KF"'
    extract:
    - 'DeviceClass                         :    500 :"Tablet"'
    - 'DeviceBrand                         :    500 :"Amazon"'
    - 'DeviceName                          :    500 :agent.(1)product.(1)comments.entry.(1)product.(1)name[2]="Build"@[1]{"KF"'
    - 'DeviceCpu                           :    100 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name{"SD"'
    extract:
    - 'DeviceClass                         :    500 :"Phone"'
    - 'DeviceBrand                         :    500 :"Amazon"'
    - 'DeviceName                          :    500 :agent.(1)product.(1)comments.entry.(1)product.(1)name[2]="Build"@[1]{"SD"'
    - 'DeviceCpu                           :    100 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name[1]="Amazon"'
    extract:
    - 'DeviceBrand                         :    500 :"Amazon"'
    - 'DeviceCpu                           :    100 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name[1]="Fire"'
    extract:
    - 'DeviceBrand                         :    500 :"Amazon"'
    - 'DeviceCpu                           :    100 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name[1]="Kindle"'
    extract:
    - 'DeviceBrand                         :    500 :"Amazon"'
    - 'DeviceCpu                           :    100 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'

# https://docs.aws.amazon.com/silk/latest/developerguide/user-agent.html
# ---------------------------
# User Agent Strings and Detection
# In the user agent request header field, Amazon Silk sends one of three user agent strings,
# depending on the view requested on the device by the customer.
# If a specific view is not requested, the view defaults to Tablet for Fire tablets,
# and Mobile for Fire phones. If a site has compatibility issues when rendered in the default view,
# a different view may be selected by the device. The templates for the Amazon Silk user agents are shown below.
#
# Tablet
#   Mozilla/5.0 (Linux; Android android-version; product-model Build/product-build)
#     AppleWebKit/webkit-version (KHTML, like Gecko)
#     Silk/browser-version like Chrome/chrome-version Safari/webkit-version
#
# Desktop
#   Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/webkit-version (KHTML, like Gecko)
#     Silk/browser-version like Chrome/chrome-version Safari/webkit-version
#
# Mobile
#   Mozilla/5.0 (Linux; Android android-version; product-model Build/product-build)
#     AppleWebKit/webkit-version (KHTML, like Gecko)
#     Silk/browser-version like Chrome/chrome-version Mobile Safari/webkit-version
# ---------------------------

# Analysis of this: The user can specify what lie the useragent should reflect to get the desired result from the website.


# All devices with Silk run on Fire OS which is an Android based system.
# https://en.wikipedia.org/wiki/Fire_OS

# Silk browser

- matcher:
    require:
    - 'agent.product.(1)name="Safari"'
    extract:
    - 'DeviceClass                         :     98 :"Tablet"'
    - 'DeviceName                          :     98 :"Amazon Kindle Fire"'
    - 'DeviceBrand                         :     98 :"Amazon"'
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'AgentClass                          :   1000 :"Browser"'
    - 'AgentName                           :   1000 :"Silk"'
    - 'AgentVersion                        :   1000 :agent.product.(1)name="Silk"^.version'

- matcher:
    require:
    - 'agent.product.(1)name="Mobile Safari"'
    extract:
    - 'DeviceClass                         :     98 :"Phone"'
    - 'DeviceName                          :     98 :"Amazon Kindle Fire"'
    - 'DeviceBrand                         :     98 :"Amazon"'
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'AgentClass                          :   1000 :"Browser"'
    - 'AgentName                           :   1000 :"Silk"'
    - 'AgentVersion                        :   1000 :agent.product.(1)name="Silk"^.version'

- matcher:
    require:
    - 'agent.product.(1)name="Safari"'
    extract:
    - 'DeviceClass                         :     98 :"Tablet"'
    - 'DeviceName                          :     98 :"Amazon Kindle Fire"'
    - 'DeviceBrand                         :     98 :"Amazon"'
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'AgentClass                          :   1000 :"Browser"'
    - 'AgentName                           :   1000 :"Silk"'
    - 'AgentVersion                        :   1000 :agent.product.(1)comments.entry.(1)product.(1)name="Silk"^.version'

- matcher:
    require:
    - 'agent.product.(1)name="Mobile Safari"'
    extract:
    - 'DeviceClass                         :     98 :"Phone"'
    - 'DeviceName                          :     98 :"Amazon Kindle Fire"'
    - 'DeviceBrand                         :     98 :"Amazon"'
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'AgentClass                          :   1000 :"Browser"'
    - 'AgentName                           :   1000 :"Silk"'
    - 'AgentVersion                        :   1000 :agent.product.(1)comments.entry.(1)product.(1)name="Silk"^.version'

- matcher:
    require:
    - 'agent.product.(1)name="Silk"'
    extract:
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :   1000 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Android"^.version'


# UA for Kindle Fire 1st Generation
# The UA for the Kindle Fire 1st Generation follows a slightly different syntax.

# Desktop/Tablet
#   Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us; Silk/1.0.13.81_10003810)
#     AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16 Silk-Accelerated=true

# Mobile
#   Mozilla/5.0 (Linux; U; Android 2.3.4; en-us; Silk/1.0.13.81_10003810)
#     AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 Silk-Accelerated=true

- matcher:
    extract:
    - 'DeviceClass                         :     99 :"Tablet"'
    - 'DeviceName                          :    100 :"Amazon Kindle Fire"'
    - 'DeviceBrand                         :    100 :"Amazon"'
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'AgentClass                          :    100 :"Browser"'
    - 'AgentName                           :    100 :"Silk"'
    - 'AgentVersion                        :    100 :agent.(1)product.(1)comments.entry.(1)product.(1)name="Silk"^.version'

- matcher:
    require:
    - 'agent.product.(1)name="Silk"'
    extract:
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :     99 :"??"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)product.(1)name="Silk"'
    extract:
    - 'DeviceCpu                           :   1000 :"<<<null>>>"'
    - 'DeviceCpuBits                       :   1000 :"<<<null>>>"'
    - 'OperatingSystemClass                :   1000 :"Mobile"'
    - 'OperatingSystemName                 :   1000 :"FireOS"'
    - 'OperatingSystemVersion              :     99 :"??"'
